!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.Uploader=t()}(this,function(){"use strict";var n='<div class="ro-uploader-wrap" :class="containerClass" :style="containerStyle">',i='<div v-for="(image, index) in images" :key="index"class="ro-uploader-image-wrap":class="imageWrapClass":style="imageWrapStyle"><div v-if="!lazyload" class="ro-uploader-image":class="imageClass":style="[{\'background-image\': \'url(\' + transformImage(image) + \')\'}, imageStyle]"@click="onClickImage(index)"></div><div v-else class="ro-uploader-image":class="imageClass"v-lazy:background-image="image":style="[imageStyle]"@click="onClickImage(index)"></div><div v-if="canModify" class="ro-uploader-remove" :class="removeClass" :style="removeStyle" @click="onClickRemove(index)"></div></div><slot name="request"><div class="ro-uploader-image-wrap ro-uploader-request" v-if="images.length < size && canModify"@click="onClickRequest":class="requestClass":style="requestStyle"></div></slot></div>';function r(e){return e.extend({name:"ROUploader",props:{size:{type:Number,default:1},canModify:{type:Boolean,default:!0},containerClass:{type:[Object,Array],default:function(){return{}}},containerStyle:{type:Object,default:function(){return{}}},imageClass:{type:[Object,Array],default:function(){return{}}},imageStyle:{type:Object,default:function(){return{}}},imageWrapClass:{type:[Object,Array],default:function(){return{}}},imageWrapStyle:{type:Object,default:function(){return{}}},requestClass:{type:[Object,Array],default:function(){return{}}},requestStyle:{type:Object,default:function(){return{}}},removeClass:{type:[Object,Array],default:function(){return{}}},removeStyle:{type:Object,default:function(){return{}}},lazyload:{type:Boolean,default:!1}},data:function(){return{images:[]}},methods:{setImages:function(e){for(var t=[],n=0,i=e.length;n<i;n++)t.push(e[n]);this.images=t},add:function(e){return this.images.length<this.size&&(this.images.push(e),this.$emit("add",e),!0)},remove:function(e){return 0<=e&&e<this.size&&(this.images.splice(e,1),this.$emit("remove",e),!0)},removeAll:function(){for(var e=0,t=this.images.length;e<t;e++)this.remove(e);return!0},getImages:function(){return this.images.slice(0)},onClickImage:function(e){this.$emit("click",e)},onClickRemove:function(e){this.remove(e)},onClickRequest:function(){this.$emit("request")},getSize:function(){return this.size},getCount:function(){return this.images.length},transformImage:function(e){return e}},template:n+i})}var a=/iPhone/.test(navigator.userAgent);function s(t,i){var n,r=null;return(n=t,new Promise(function(t,e){wx.uploadImage({localId:n,isShowProgressTips:0,success:function(e){return t(e)}})})).then(function(e){return r=e.serverId,t}).then(function(e){return i?(n=e,a&&window.__wxjs_is_wkwebview?new Promise(function(t,e){wx.getLocalImgData({localId:n,success:function(e){return t(e.localData)}})}):n):e;var n}).then(function(e){return{image:e,serverId:r}})}function o(e,t){return r(e).extend({name:"WechatUploader",props:{useWechatPreview:{type:Boolean,default:!0}},methods:{onClickRequest:function(){this.request()},request:function(){var n,i=this;return(n=i.size-i.images.length,new Promise(function(t,e){wx.chooseImage({count:n,sizeType:["compressed"],success:function(e){return t(e)}})})).then(function(e){var t=e.localIds;if(0<t.length)return i.$emit("choose",e),i.$emit("load"),i.uploadWechatImages(t).then(function(){i.$emit("finish")})})},uploadWechatImages:function(i){var r=this;return s(i.shift(),t.transformWXLocalImageData).then(function(e){var t=e.image,n=e.serverId;if(r.add({image:t,serverId:n}),0<i.length)return r.uploadWechatImages(i)})},transformImage:function(e){return e.image}},mounted:function(){this.$on("click",function(e){var t,n;t=this.images[e].image,n=this.images.map(function(e){return e.image}),wx.previewImage({current:t,urls:n})})}})}var u=!1;return function(e,t){u||(u=!0,e.component("Uploader",r(e)),e.component("WechatUploader",o(e,t)),e.component("InputUploader",r(e).extend({name:"InputUploader",methods:{onClickRequest:function(){this.request()},request:function(){var e=this.$refs.fileInput;console.log(this.$refs),e&&e.click()},remove:function(e){if(0<=e&&e<this.size){for(var t=this.images.splice(e,1),n=0,i=t.length;n<i;n++)URL.revokeObjectURL(t[n].objectUrl);return this.$emit("remove",e),!0}return!1},onChangeInput:function(){var e=this.$refs.fileInput;if(e)for(var t=0,n=e.files.length;t<n;t++){if(this.images.length>=this.size)return;this.add({file:e.files[t],objectUrl:URL.createObjectURL(e.files[t])})}},transformImage:function(e){return e.objectUrl}},template:n+'<input ref="fileInput" class="ro-uploader-input" type="file" @change="onChangeInput" :multiple="(size - images.length) > 1" />'+i})))}});
