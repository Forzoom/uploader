!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.Uploader=t()}(this,function(){"use strict";function n(e){return e.extend({name:"ROUploader",props:{size:{type:Number,default:1},canModify:{type:Boolean,default:!0},containerClass:{type:[Object,Array],default:function(){return{}}},containerStyle:{type:Object,default:function(){return{}}},imageClass:{type:[Object,Array],default:function(){return{}}},imageStyle:{type:Object,default:function(){return{}}},imageWrapClass:{type:[Object,Array],default:function(){return{}}},imageWrapStyle:{type:Object,default:function(){return{}}},requestClass:{type:[Object,Array],default:function(){return{}}},requestStyle:{type:Object,default:function(){return{}}},removeClass:{type:[Object,Array],default:function(){return{}}},removeStyle:{type:Object,default:function(){return{}}},lazyload:{type:Boolean,default:!1}},data:function(){return{images:[]}},methods:{setImages:function(e){for(var t=[],n=0,i=e.length;n<i;n++)t.push(e[n]);this.images=t},add:function(e){return this.images.length<this.size&&(this.images.push(e),this.$emit("add",e),!0)},remove:function(e){return 0<=e&&e<this.size&&(this.images.splice(e,1),this.$emit("remove",e),!0)},removeAll:function(){for(var e=0,t=this.images.length;e<t;e++)this.remove(e);return!0},getImages:function(){return this.images.slice(0)},onClickImage:function(e){this.$emit("click",e)},onClickRemove:function(e){this.remove(e)},onClickRequest:function(){this.$emit("request")},getSize:function(){return this.size},getCount:function(){return this.images.length},transformImage:function(e){return e}},template:'<div class="ro-uploader-wrap" :class="containerClass" :style="containerStyle"><slot name="extra"></slot><div v-for="(image, index) in images" :key="index"class="ro-uploader-image-wrap":class="imageWrapClass":style="imageWrapStyle"><div v-if="!lazyload" class="ro-uploader-image":class="imageClass":style="[{\'background-image\': \'url(\' + transformImage(image) + \')\'}, imageStyle]"@click="onClickImage(index)"></div><div v-else class="ro-uploader-image":class="imageClass"v-lazy:background-image="image":style="[imageStyle]"@click="onClickImage(index)"></div><div v-if="canModify" class="ro-uploader-remove" :class="removeClass" :style="removeStyle" @click="onClickRemove(index)"></div></div><slot name="request"><div class="ro-uploader-image-wrap ro-uploader-request" v-if="images.length < size && canModify"@click="onClickRequest":class="requestClass":style="requestStyle"></div></slot></div>'})}var r=/iPhone/.test(navigator.userAgent);function s(t,i){var n,a=null;return(n=t,new Promise(function(t,e){wx.uploadImage({localId:n,isShowProgressTips:0,success:function(e){return t(e)}})})).then(function(e){return a=e.serverId,t}).then(function(e){return i?(n=e,r&&window.__wxjs_is_wkwebview?new Promise(function(t,e){wx.getLocalImgData({localId:n,success:function(e){return t(e.localData)}})}):n):e;var n}).then(function(e){return{image:e,serverId:a}})}function i(e,t){return n(e).extend({name:"WechatUploader",props:{useWechatPreview:{type:Boolean,default:!0}},methods:{onClickRequest:function(){this.request()},request:function(){var n,i=this;return(n=i.size-i.images.length,new Promise(function(t,e){wx.chooseImage({count:n,sizeType:["compressed"],success:function(e){return t(e)}})})).then(function(e){var t=e.localIds;if(0<t.length)return i.$emit("choose",e),i.$emit("load"),i.uploadWechatImages(t).then(function(){i.$emit("finish")})})},uploadWechatImages:function(i){var a=this;return s(i.shift(),t.transformWXLocalImageData).then(function(e){var t=e.image,n=e.serverId;if(a.add({image:t,serverId:n}),0<i.length)return a.uploadWechatImages(i)})},transformImage:function(e){return e.image}},mounted:function(){this.$on("click",function(e){var t,n;t=this.images[e].image,n=this.images.map(function(e){return e.image}),wx.previewImage({current:t,urls:n})})}})}var a=!1;return function(e,t){a||(a=!0,e.component("Uploader",n(e)),e.component("WechatUploader",i(e,t)))}});
